# Генератор Makefile

Этот сценарий генерирует `Makefile` для утилиты `make`. Теперь можно забыть про пакетные файлы и компиляцию из командной строки.

## Почему утилита make

Утилита `make` используется для сборки чего‐нибудь по рецепту. Сама по себе утилита ничего не собирает, она читает «файл рецепта» и вызывает команды, чтобы «приготовить блюдо». Чаще всего `make` используют для компиляции программ, но это совсем необязательно.

Так почему нам следует использовать `make` и усложнять сборку программы, когда достаточно выполнить одну простую команду `fbc *.bas`? Утилита `make` имеет неоспоримое преимущество: нет нужды пересобирать то, что не изменилось.

Предположим, наш проект состоит из сотни файлов. Когда мы изменяем одну строку кода в файле, то команда `fbc *.bas` перекомпилирует все файлы. Это занимает время, нагружает процессор и изнашивает диск. Утилита `make` пересобирает только изменившиеся файлы.

## Подготовления

Генератор требует, чтобы проект был организован определённым образом.

Проект:

```
MyProject:
	bin\          — каталог для исполняемых файлов
		Debug\    — отладочная версия
			x64\  — для Windows 64 бит
			x86\  — для Windows 64 бит
		Release   — окончательная версия
			x64\
			x86\
	obj\          — каталог для объектных файлов
		Debug\
			x64\
			x86\
		Release
			x64\
			x86\
	src\          — каталог для файлов исходного кода
		main.bas  — все файлы исходного кода
		main.bi
	
	CreateMakefile.vbs — Генератор makefile
	
	fix-emitted-code.vbs — сценарий для исправления промежуточного си‐кода
	
	Makefile           — сгенерированный файл
```

## Параметры

Параметры для сценария указываются в именованном виде: `/параметр:значение`.

### out

Имя исполняемого файла.

Имя файла указывается без расширения. Например, скомпилированная программа должна иметь имя `HelloWorld.exe`, указываем здесь `HelloWorld`.

По умолчанию равно `a`.

### makefile

Имя генерируемого файла для утилиты `make`.

По умолчанию равно `Makefile`.

### fbc

Имя файла компилятора.

По умолчанию равно `fbc64.exe`.

### fbc-path

Путь к файлу компилятора.

По умолчанию равно `C:\Program Files (x86)\FreeBASIC-1.10.0-winlibs-gcc-9.3.0`.

### src

Каталог с исходными кодами.

По умолчанию равен `src`.

### module

Главный модуль программы.

По умолчанию равен названию программы (без расширения).

### exetype

Тип генерируемого исполняемого файла.

Может принимать следующий значения:

| Тип | Описание                          |
|-----|-----------------------------------|
| exe | Исполняемый файл |
| dll | Динамически загружаемая библиотека |
| lib | Статически загружаемая библиотека |
| wasm32 | WebAssembly |
| wasm64 | WebAssembly 64 бита |

По умолчанию равен `exe`.

Примечание: поддержка wasm64 в браузерах находится в экспериментальном режиме, и может не работать корректно.

### subsystem

Подсистема исполняемого файла. Применимо только к файлам типа `exe`.

| Подсистема | Описание                          |
|-----|-----------------------------------|
| console | Консольная программа для WinAPI |
| windows | Оконная программа для WinAPI |
| native | Программа для NT API |

По умолчанию равен `console`.

### emitter

Задаёт генератор промежуточного кода для цепочки инструментов.

| Генератор | Описание                          |
|-----|-----------------------------------|
| gcc | Кодогенератор для компилятора Си. |
| gas | Кодогенератор для ассемблера |
| gas64 | 64‐битный ассемблер |
| llvm | Низкоуровневая виртуальная машина |
| wasm32 | WebAssembly 32 бит |
| wasm64 | WebAssembly 64 бит |

По умолчанию равен `gcc`.

Примечание: поддержка wasm64 в браузерах находится в экспериментальном режиме, и может не работать корректно.

### fix

Добавляет сценарий исправления сгенерированного промежуточного кода.

Компилятор фрибейсика генерирует промежуточный код для GCC и использует расширения GCC. Некоторые конструкции не будут работать для другого компилятора, например шланга.

По умолчанию `false`.

### unicode

Задаёт константу `UNICODE` для WinAPI.

| Юникод | Описание                          |
|-----|-----------------------------------|
| true | Включает `UNICODE` |
| false | Выключает `UNICODE` |

По умолчанию равен `false`.

### wrt

Выключает библиотеки времени выполнения. Чтобы выключить библиотеки, установите этот параметр в `true`.

По умолчанию равен `false`.

### addressaware

Включает использование адресного пространства больше 2 гигабайт.

Чтобы использовать адресное пространство больше двух гигабайт, исполняемый файл должен быть отмечен этим флагом. Установите это значение в `true`. Применимо только для 32‐битных программ.

По умолчанию равен `false`.

### multithreading

Включает многопоточные библиотеки времени выполнения.

По умолчанию равен `false`.

### usefilesuffix

Включает использование файлового суффикса.

По умолчанию равен `true`.

## Пути к цепочке инструментов

Переменные среды, которые нужны для запуска.

Ресурсные файлы: RC, манифесты.

## Примеры

### GUI Программа

Оконная программа с поддержкой юникода, библиотеками времени выполнения и адресного пространства больше 2 гигабайт:

```
cscript.exe //nologo CreateMakefile.vbs /out:TestGui /subsystem:windows /unicode:true /addressaware:true
```

### WebAssembly

```
cscript //nologo CreateMakefile.vbs /out:add /fix:true /emitter:wasm32 /exetype:wasm32
```
